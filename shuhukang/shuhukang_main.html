<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>术互康 - 主界面</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6', // 浅蓝色
                        secondary: '#60A5FA',
                        accent: '#93C5FD',
                        neutral: '#F3F4F6',
                        'neutral-dark': '#6B7280',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .progress-ring-circle {
                transition: stroke-dashoffset 0.35s;
                transform: rotate(-90deg);
                transform-origin: 50% 50%;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20"> <!-- 为底部导航栏留出空间 -->
    <!-- 顶部导航栏 -->
    <nav class="bg-white shadow-md sticky top-0 z-10">
        <div class="w-full px-4">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fa fa-heartbeat text-primary text-2xl mr-2"></i>
                        <span class="font-bold text-gray-800">术护康</span>
                    </div>
                </div>
                <div class="flex items-center" id="userInfo">
                    <!-- 用户信息将在这里动态显示 -->
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 标签页导航 - 移动端适配 -->
        <div class="mb-4">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button id="tab-rehabilitation" class="whitespace-nowrap py-3 px-1 border-b-2 border-primary font-medium text-sm text-primary">
                        任务导航
                    </button>
                    <button id="tab-videos" class="whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        问题反馈
                    </button>
                    <button id="tab-settings" class="whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        设置
                    </button>
                </nav>
            </div>
        </div>

        <!-- 标签页内容 -->
        <div class="tab-content">
            <!-- 任务导航标签页 -->
            <div id="content-rehabilitation" class="tab-pane active">
                <!-- 患者基本信息卡片 -->
                <div class="bg-white rounded-lg shadow-md p-4 card-shadow mb-4">
                    <div class="flex items-center mb-3">
                        <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center text-xl">
                            <span id="patientInitial">张</span>
                        </div>
                        <div class="ml-3">
                            <h2 class="text-lg font-semibold text-gray-800" id="patientName">张三</h2>
                            <p class="text-sm text-gray-600" id="patientId">住院号: 20250721-001</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="bg-blue-50 p-2 rounded">
                            <span class="text-gray-600">康复阶段:</span>
                            <span class="font-medium text-primary" id="recoveryStage">术后第3天</span>
                        </div>
                        <div class="bg-blue-50 p-2 rounded">
                            <span class="text-gray-600">预计完成:</span>
                            <span class="font-medium text-primary" id="estimatedCompletion">2025/08/15</span>
                        </div>
                    </div>
                </div>

                <!-- 术前进度卡片 -->
                <div class="bg-white rounded-lg shadow-md p-4 card-shadow mb-4">
                    <h3 class="text-md font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-calendar-check-o text-primary mr-2"></i>术前准备
                    </h3>
                    <div class="space-y-3">
                        <div class="border-l-4 border-green-400 pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">术前评估</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">已完成</span>
                            </div>
                            <div class="mt-1 space-y-1">
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">血常规检查</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">尿常规检查</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">凝血功能检查</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">心电图检查</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">腹部超声检查</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                            </div>
                        </div>

                        <div class="border-l-4 border-green-400 pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">知情同意</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">已完成</span>
                            </div>
                            <div class="mt-1 space-y-1">
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">手术风险告知</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">术后注意事项说明</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">签署知情同意书</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                            </div>
                        </div>

                        <div class="border-l-4 border-green-400 pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">术前指导</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">已完成</span>
                            </div>
                            <div class="mt-1 space-y-1">
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">肠道准备</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">禁食指导（术前12小时）</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">皮肤准备</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-gray-600">心理疏导</span>
                                    <i class="fa fa-check text-green-500"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 术后进度卡片 -->
                <div class="bg-white rounded-lg shadow-md p-4 card-shadow mb-4">
                    <h3 class="text-md font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-heartbeat text-primary mr-2"></i>术后康复
                    </h3>
                    <div class="space-y-3">
                        <div class="border-l-4 border-primary pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">术后第一天</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">已完成</span>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                                    <span class="text-xs text-gray-700">床上活动</span>
                                    <div class="flex items-center">
                                        <button class="text-xs text-primary flex items-center mr-2 ai-guide-btn" data-action="bed-activity">
                                            <i class="fa fa-robot mr-1"></i>AI指导
                                        </button>
                                        <input type="checkbox" class="h-3 w-3 text-primary focus:ring-primary border-gray-300 rounded task-checkbox">
                                    </div>
                                </div>
                                <div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                                    <span class="text-xs text-gray-700">呼吸训练</span>
                                    <div class="flex items-center">
                                        <button class="text-xs text-primary flex items-center mr-2 ai-guide-btn" data-action="breathing">
                                            <i class="fa fa-robot mr-1"></i>AI指导
                                        </button>
                                        <input type="checkbox" class="h-3 w-3 text-primary focus:ring-primary border-gray-300 rounded task-checkbox">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="border-l-4 border-primary pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">术后第二天</span>
                                <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">已完成</span>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                                    <span class="text-xs text-gray-700">下床活动</span>
                                    <div class="flex items-center">
                                        <button class="text-xs text-primary flex items-center mr-2 ai-guide-btn" data-action="walking">
                                            <i class="fa fa-robot mr-1"></i>AI指导
                                        </button>
                                        <input type="checkbox" class="h-3 w-3 text-primary focus:ring-primary border-gray-300 rounded task-checkbox">
                                    </div>
                                </div>
                                <div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                                    <span class="text-xs text-gray-700">伤口护理</span>
                                    <div class="flex items-center">
                                        <button class="text-xs text-primary flex items-center mr-2 ai-guide-btn" data-action="wound-care">
                                            <i class="fa fa-robot mr-1"></i>AI指导
                                        </button>
                                        <input type="checkbox" class="h-3 w-3 text-primary focus:ring-primary border-gray-300 rounded task-checkbox">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="border-l-4 border-primary pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">术后第三天 <span class="text-xs text-primary">(当前)</span></span>
                                <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">进行中</span>
                            </div>
                            <div class="mt-2 space-y-2">
                                <div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                                    <span class="text-xs text-gray-700">轻度运动</span>
                                    <div class="flex items-center">
                                        <button class="text-xs text-primary flex items-center mr-2 ai-guide-btn" data-action="light-exercise">
                                            <i class="fa fa-robot mr-1"></i>AI指导
                                        </button>
                                        <input type="checkbox" class="h-3 w-3 text-primary focus:ring-primary border-gray-300 rounded task-checkbox">
                                    </div>
                                </div>
                                <div class="flex items-center justify-between bg-blue-50 p-2 rounded">
                                    <span class="text-xs text-gray-700">饮食指导</span>
                                    <div class="flex items-center">
                                        <button class="text-xs text-primary flex items-center mr-2 ai-guide-btn" data-action="diet">
                                            <i class="fa fa-robot mr-1"></i>AI指导
                                        </button>
                                        <input type="checkbox" class="h-3 w-3 text-primary focus:ring-primary border-gray-300 rounded task-checkbox">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 问题反馈标签页 -->
            <div id="content-videos" class="tab-pane hidden">
                <!-- 问题反馈表单 -->
                <div class="bg-white rounded-lg shadow-md p-4 card-shadow mb-4">
                    <h2 class="text-md font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-comment-medical text-primary mr-2"></i>向医护人员提问
                    </h2>
                    <form id="feedbackForm" class="space-y-3">
                        <div>
                            <label for="feedbackType" class="block text-sm font-medium text-gray-700 mb-1">问题类型</label>
                            <select id="feedbackType" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="symptom">症状相关</option>
                                <option value="wound">伤口护理</option>
                                <option value="diet">饮食问题</option>
                                <option value="exercise">运动康复</option>
                                <option value="medication">用药咨询</option>
                                <option value="other">其他问题</option>
                            </select>
                        </div>
                        <div>
                            <label for="feedbackContent" class="block text-sm font-medium text-gray-700 mb-1">问题描述</label>
                            <textarea id="feedbackContent" rows="4" placeholder="请详细描述您的问题..." class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">添加图片（可选）</label>
                            <div class="flex space-x-2">
                                <div class="w-16 h-16 bg-gray-100 border border-dashed border-gray-300 rounded-md flex items-center justify-center cursor-pointer hover:bg-gray-50">
                                    <i class="fa fa-plus text-gray-400"></i>
                                    <input type="file" accept="image/*" class="hidden">
                                </div>
                                <div class="w-16 h-16 bg-gray-100 border border-dashed border-gray-300 rounded-md flex items-center justify-center cursor-pointer hover:bg-gray-50">
                                    <i class="fa fa-plus text-gray-400"></i>
                                    <input type="file" accept="image/*" class="hidden">
                                </div>
                                <div class="w-16 h-16 bg-gray-100 border border-dashed border-gray-300 rounded-md flex items-center justify-center cursor-pointer hover:bg-gray-50">
                                    <i class="fa fa-plus text-gray-400"></i>
                                    <input type="file" accept="image/*" class="hidden">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-primary text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            提交问题
                        </button>
                    </form>
                </div>

                <!-- 历史反馈记录 -->
                <div class="bg-white rounded-lg shadow-md p-4 card-shadow">
                    <h2 class="text-md font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-history text-primary mr-2"></i>历史反馈记录
                    </h2>
                    <div class="space-y-3">
                        <div class="border-l-4 border-blue-400 pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">伤口护理</span>
                                <span class="text-xs text-gray-500">今天 09:15</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">伤口周围有轻微红肿，是否正常？需要特殊处理吗？</p>
                            <div class="mt-2 bg-blue-50 p-2 rounded text-xs">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="font-medium text-blue-700">李医生</span>
                                    <span class="text-gray-500">今天 10:30</span>
                                </div>
                                <p class="text-gray-700">轻微红肿是正常现象，注意保持清洁干燥，避免摩擦。如果出现疼痛加剧或渗液增多，请立即联系我们。</p>
                            </div>
                        </div>

                        <div class="border-l-4 border-green-400 pl-3 py-1">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-800">饮食问题</span>
                                <span class="text-xs text-gray-500">昨天 14:40</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">术后可以吃哪些食物？有什么需要特别注意的吗？</p>
                            <div class="mt-2 bg-blue-50 p-2 rounded text-xs">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="font-medium text-blue-700">王护士</span>
                                    <span class="text-gray-500">昨天 15:20</span>
                                </div>
                                <p class="text-gray-700">目前您可以进食流质或半流质食物，如粥、藕粉、蛋羹等。避免辛辣、油腻、刺激性食物，逐步过渡到正常饮食。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 设置标签页 -->
            <div id="content-settings" class="tab-pane hidden">
                <div class="bg-white rounded-lg shadow-md p-6 card-shadow">
                    <h2 class="text-lg font-semibold text-gray-800 mb-6">应用设置</h2>

                    <!-- 字体大小设置 -->
                    <div class="mb-8">
                        <h3 class="text-md font-medium text-gray-700 mb-4">字体大小</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">小</span>
                            <input type="range" min="12" max="20" value="16" class="w-2/3 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="fontSizeSlider">
                            <span class="text-sm text-gray-500">大</span>
                        </div>
                        <div class="text-center mt-2">
                            <span class="text-base font-medium text-gray-800" id="fontSizeDisplay">标准</span>
                        </div>
                    </div>

                    <!-- 康复报告设置 -->
                    <div class="mb-8">
                        <h3 class="text-md font-medium text-gray-700 mb-4">康复报告</h3>
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <h4 class="text-sm font-medium text-gray-800">每周报告</h4>
                                <p class="text-xs text-gray-500">每周一早上8:00生成</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                            </label>
                        </div>
                    </div>

                    <!-- 其他设置 -->
                    <div>
                        <h3 class="text-md font-medium text-gray-700 mb-4">其他</h3>
                        <button id="logoutBtn" class="w-full flex justify-center py-3 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            退出登录
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部导航栏 -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 z-20">
        <div class="flex justify-around">
            <button id="nav-rehabilitation" class="flex flex-col items-center py-2 px-4 text-primary">
                <i class="fa fa-tasks text-lg"></i>
                <span class="text-xs mt-1">任务导航</span>
            </button>
            <button id="nav-videos" class="flex flex-col items-center py-2 px-4 text-gray-500">
                <i class="fa fa-comments text-lg"></i>
                <span class="text-xs mt-1">问题反馈</span>
            </button>
            <button id="nav-settings" class="flex flex-col items-center py-2 px-4 text-gray-500">
                <i class="fa fa-cog text-lg"></i>
                <span class="text-xs mt-1">设置</span>
            </button>
        </div>
    </nav>

    <script>
        // 页面加载时检查用户是否已登录
        document.addEventListener('DOMContentLoaded', function() {
            const userName = localStorage.getItem('userName') || '张三';
            const hospitalId = localStorage.getItem('hospitalId') || '20250721-001';

            if (!userName || !hospitalId) {
                // 如果用户未登录，重定向到登录页面
                window.location.href = 'index.html';
            } else {
                // 显示用户信息
                document.getElementById('userInfo').innerHTML = `
                    <span class="text-sm text-gray-700 mr-2">${userName}</span>
                    <button id="avatarBtn" class="flex-shrink-0">
                        <div class="h-8 w-8 rounded-full bg-primary text-white flex items-center justify-center">
                            ${userName.charAt(0)}
                        </div>
                    </button>
                `;

                // 更新患者信息
                document.getElementById('patientName').textContent = userName;
                document.getElementById('patientId').textContent = `住院号: ${hospitalId}`;
                document.getElementById('patientInitial').textContent = userName.charAt(0);
            }

            // 设置标签页切换
            setupTabs();

            // 设置字体大小滑块
            setupFontSizeSlider();

            // 设置退出登录按钮
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('userName');
                localStorage.removeItem('hospitalId');
                window.location.href = 'index.html';
            });

            // 设置AI指导按钮点击事件
            setupAIGuideButtons();

            // 设置任务勾选功能
            setupTaskCheckboxes();

            // 设置语音点播按钮
            setupVoiceGuide();

            // 设置下一步按钮
            setupNextStep();

            // 设置体位拍照
            setupPositionPhoto();

            // 设置问题反馈表单
            setupFeedbackForm();
        });

        // 设置标签页切换
        function setupTabs() {
            const tabs = ['rehabilitation', 'videos', 'settings'];

            // 顶部标签页切换
            tabs.forEach(tab => {
                document.getElementById(`tab-${tab}`).addEventListener('click', function() {
                    switchTab(tab);
                });

                // 底部导航栏切换
                document.getElementById(`nav-${tab}`).addEventListener('click', function() {
                    switchTab(tab);
                });
            });
        }

        // 切换标签页的函数
        function switchTab(activeTab) {
            const tabs = ['rehabilitation', 'videos', 'settings'];

            // 移除所有标签页的活动状态
            tabs.forEach(tab => {
                // 顶部标签页
                document.getElementById(`tab-${tab}`).classList.remove('border-primary', 'text-primary');
                document.getElementById(`tab-${tab}`).classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

                // 底部导航栏
                document.getElementById(`nav-${tab}`).classList.remove('text-primary');
                document.getElementById(`nav-${tab}`).classList.add('text-gray-500');

                // 内容区域
                document.getElementById(`content-${tab}`).classList.add('hidden');
            });

            // 设置当前标签页为活动状态
            document.getElementById(`tab-${activeTab}`).classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            document.getElementById(`tab-${activeTab}`).classList.add('border-primary', 'text-primary');

            document.getElementById(`nav-${activeTab}`).classList.remove('text-gray-500');
            document.getElementById(`nav-${activeTab}`).classList.add('text-primary');

            document.getElementById(`content-${activeTab}`).classList.remove('hidden');
        }

        // 设置字体大小滑块
        function setupFontSizeSlider() {
            const slider = document.getElementById('fontSizeSlider');
            const display = document.getElementById('fontSizeDisplay');

            if (slider && display) {
                slider.addEventListener('input', function() {
                    const size = this.value;
                    document.body.style.fontSize = `${size}px`;

                    // 更新显示文本
                    if (size < 14) {
                        display.textContent = '小';
                    } else if (size > 17) {
                        display.textContent = '大';
                    } else {
                        display.textContent = '标准';
                    }
                });
            }
        }

        // 设置AI指导按钮点击事件
        function setupAIGuideButtons() {
            const aiButtons = document.querySelectorAll('.ai-guide-btn');

            aiButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const actionType = this.getAttribute('data-action');

                    // 创建AI指导弹窗
                    createAIGuideModal(actionType);
                });
            });
        }

        // 创建AI指导弹窗
        function createAIGuideModal(actionType) {
            // 定义动作类型对应的标题和描述
            const actionInfo = {
                'bed-activity': {
                    title: '床上活动AI指导',
                    description: '请按照以下姿势进行床上活动训练，完成后点击拍照按钮进行AI纠正。'
                },
                'breathing': {
                    title: '呼吸训练AI指导',
                    description: '请按照以下方法进行呼吸训练，完成后点击拍照按钮进行AI纠正。'
                },
                'walking': {
                    title: '下床活动AI指导',
                    description: '请按照以下姿势安全下床活动，完成后点击拍照按钮进行AI纠正。'
                },
                'wound-care': {
                    title: '伤口护理AI指导',
                    description: '请按照以下方法进行伤口护理，完成后点击拍照按钮进行AI纠正。'
                },
                'light-exercise': {
                    title: '轻度运动AI指导',
                    description: '请按照以下动作进行轻度运动，完成后点击拍照按钮进行AI纠正。'
                },
                'diet': {
                    title: '饮食指导AI建议',
                    description: '请按照以下建议调整饮食，完成后可记录您的饮食情况。'
                }
            };

            const info = actionInfo[actionType] || {
                title: 'AI指导',
                description: '请按照指导完成动作，完成后点击拍照按钮进行AI纠正。'
            };

            // 创建弹窗HTML
            const modalHTML = `
                <div id="aiGuideModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg w-full max-w-md overflow-hidden">
                        <!-- 弹窗头部 -->
                        <div class="bg-primary text-white p-4 flex justify-between items-center">
                            <h3 class="text-lg font-semibold">${info.title}</h3>
                            <button id="closeModalBtn" class="text-white hover:text-gray-200">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>

                        <!-- 弹窗内容 -->
                        <div class="p-4">
                            <p class="text-sm text-gray-700 mb-4">${info.description}</p>

                            <!-- 动作示意图 -->
                            <div class="w-full h-40 bg-gray-100 rounded-lg mb-4 flex items-center justify-center">
                                <i class="fa fa-image text-gray-400 text-3xl"></i>
                                <span class="ml-2 text-sm text-gray-500">动作示意图</span>
                            </div>

                            <!-- AI体位纠正 -->
                            <div class="border-t pt-3 mt-3">
                                <h4 class="text-sm font-semibold text-gray-800 mb-2 flex items-center">
                                    <i class="fa fa-camera text-primary mr-2"></i>AI体位纠正
                                </h4>
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <p class="text-xs text-gray-700 mb-2">体位摆放完成，请正面拍摄体位</p>
                                    <div class="relative w-full h-32 bg-white border border-dashed border-gray-300 rounded-lg flex items-center justify-center mb-2">
                                        <i class="fa fa-camera text-gray-400 text-3xl"></i>
                                        <input type="file" id="modalPositionPhoto" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer">
                                    </div>
                                    <div class="flex justify-between">
                                        <button id="modalVoiceGuideBtn" class="text-xs bg-primary text-white px-3 py-1 rounded flex items-center">
                                            <i class="fa fa-volume-up mr-1"></i>语音点播
                                        </button>
                                        <button id="modalNextStepBtn" class="text-xs bg-primary text-white px-3 py-1 rounded flex items-center">
                                            下一步 <i class="fa fa-arrow-right ml-1"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 将弹窗添加到页面
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // 添加弹窗事件监听
            document.getElementById('closeModalBtn').addEventListener('click', function() {
                document.getElementById('aiGuideModal').remove();
            });

            // 添加拍照事件监听
            document.getElementById('modalPositionPhoto').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    // 模拟AI分析过程
                    alert('AI体位分析模拟：正在分析您的体位...');

                    setTimeout(() => {
                        alert('AI分析结果：体位正确，请继续保持。');
                    }, 1500);
                }
            });

            // 添加语音点播事件监听
            document.getElementById('modalVoiceGuideBtn').addEventListener('click', function() {
                alert('语音指导模拟：正在播放体位指导语音');
            });

            // 添加下一步按钮事件监听
            document.getElementById('modalNextStepBtn').addEventListener('click', function() {
                alert('已完成当前训练指导');
                document.getElementById('aiGuideModal').remove();
            });
        }

        // 设置任务勾选功能
        function setupTaskCheckboxes() {
            const checkboxes = document.querySelectorAll('.task-checkbox');

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // 获取对应的任务文本
                    const taskText = this.closest('div').previousElementSibling;

                    if (this.checked) {
                        // 任务完成，添加删除线
                        taskText.classList.add('line-through', 'text-gray-400');

                        // 显示完成提示
                        const taskItem = this.closest('.bg-blue-50');
                        const completionBadge = document.createElement('span');
                        completionBadge.className = 'text-xs px-2 py-0.5 bg-green-100 text-green-800 rounded-full absolute right-2';
                        completionBadge.textContent = '已完成';

                        taskItem.style.position = 'relative';
                        taskItem.appendChild(completionBadge);

                        // 模拟任务完成记录
                        alert('任务已标记为完成，记录已保存');
                    } else {
                        // 取消完成，移除删除线
                        taskText.classList.remove('line-through', 'text-gray-400');

                        // 移除完成标记
                        const taskItem = this.closest('.bg-blue-50');
                        const completionBadge = taskItem.querySelector('.bg-green-100');
                        if (completionBadge) {
                            completionBadge.remove();
                        }
                    }
                });
            });
        }

        // 设置语音点播
        function setupVoiceGuide() {
            const voiceGuideBtn = document.getElementById('voiceGuideBtn');

            if (voiceGuideBtn) {
                voiceGuideBtn.addEventListener('click', function() {
                    // 模拟语音点播功能
                    alert('语音指导模拟：正在播放体位指导语音');

                    // 实际应用中应该使用Web Speech API或其他TTS服务
                    // const textToSpeak = document.getElementById('videoDescription').textContent;
                    // const utterance = new SpeechSynthesisUtterance(textToSpeak);
                    // utterance.lang = 'zh-CN';
                    // speechSynthesis.speak(utterance);
                });
            }
        }

        // 设置下一步按钮
        function setupNextStep() {
            const nextStepBtn = document.getElementById('nextStepBtn');

            if (nextStepBtn) {
                nextStepBtn.addEventListener('click', function() {
                    alert('已完成当前训练，准备进入下一步');
                    // 这里可以添加实际的下一步逻辑
                });
            }
        }

        // 设置体位拍照
        function setupPositionPhoto() {
            const positionPhoto = document.getElementById('positionPhoto');

            if (positionPhoto) {
                positionPhoto.addEventListener('change', function(e) {
                    if (e.target.files && e.target.files[0]) {
                        // 模拟AI分析过程
                        alert('AI体位分析模拟：正在分析您的体位...');

                        // 实际应用中应该使用Canvas或其他方式处理图片
                        // 然后调用AI服务进行分析

                        setTimeout(() => {
                            alert('AI分析结果：体位正确，请继续保持。');
                        }, 1500);
                    }
                });
            }
        }

        // 设置问题反馈表单
        function setupFeedbackForm() {
            const feedbackForm = document.getElementById('feedbackForm');

            if (feedbackForm) {
                feedbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();

                    const feedbackType = document.getElementById('feedbackType').value;
                    const feedbackContent = document.getElementById('feedbackContent').value;

                    if (!feedbackContent.trim()) {
                        alert('请输入您的问题描述');
                        return;
                    }

                    // 模拟提交过程
                    alert('问题提交成功，医护人员将尽快回复您！');

                    // 重置表单
                    feedbackForm.reset();
                });

                // 设置图片上传按钮
                const imageUploadButtons = feedbackForm.querySelectorAll('.w-16.h-16');
                imageUploadButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const fileInput = this.querySelector('input[type="file"]');
                        fileInput.click();
                    });

                    const fileInput = button.querySelector('input[type="file"]');
                    fileInput.addEventListener('change', function(e) {
                        if (e.target.files && e.target.files[0]) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                // 创建图片预览
                                const img = document.createElement('img');
                                img.src = event.target.result;
                                img.className = 'w-full h-full object-cover rounded-md';

                                // 清空按钮内容并添加图片
                                button.innerHTML = '';
                                button.appendChild(img);

                                // 添加删除按钮
                                const deleteBtn = document.createElement('button');
                                deleteBtn.className = 'absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs';
                                deleteBtn.innerHTML = '×';
                                deleteBtn.onclick = function(e) {
                                    e.stopPropagation();
                                    button.innerHTML = '<i class="fa fa-plus text-gray-400"></i><input type="file" accept="image/*" class="hidden">';

                                    // 重新绑定点击事件
                                    const newFileInput = button.querySelector('input[type="file"]');
                                    newFileInput.addEventListener('change', fileInput.onchange);
                                    button.addEventListener('click', function() {
                                        newFileInput.click();
                                    });
                                };

                                button.style.position = 'relative';
                                button.appendChild(deleteBtn);
                            };
                            reader.readAsDataURL(e.target.files[0]);
                        }
                    });
                });
            }
        }
    </script>
</body>
</html>